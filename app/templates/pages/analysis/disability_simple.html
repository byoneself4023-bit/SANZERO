<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¥í•´ë“±ê¸‰ ì˜ˆì¸¡ - SANZERO</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; line-height: 1.6; color: #333; background: #f8fafc; }

        /* í—¤ë” */
        .header { background: white; color: #374151; padding: 1rem 0; border-bottom: 1px solid #e5e7eb; }
        .header .container { display: flex; justify-content: space-between; align-items: center; }
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            text-decoration: none;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .logo:hover {
            text-decoration: none;
            color: #2563eb;
        }
        .bg-primary-600 { background-color: #2563eb; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .space-x-1 > * + * { margin-left: 4px; }
        .space-x-2 > * + * { margin-left: 8px; }
        .w-8 { width: 2rem; }
        .h-8 { height: 2rem; }
        .w-5 { width: 1.25rem; }
        .h-5 { height: 1.25rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
        .font-bold { font-weight: 700; }
        .text-white { color: #ffffff; }
        .text-gray-900 { color: #111827; }
        .text-gray-700 { color: #374151; }
        .text-gray-400 { color: #9ca3af; }
        .text-primary-600 { color: #2563eb; }
        .justify-center { justify-content: center; }
        .bg-primary-100 { background-color: #dbeafe; }
        .rounded-full { border-radius: 9999px; }
        .relative { position: relative; }
        .absolute { position: absolute; }
        .right-0 { right: 0; }
        .mt-2 { margin-top: 0.5rem; }
        .w-48 { width: 12rem; }
        .w-4 { width: 1rem; }
        .h-4 { height: 1rem; }
        .hidden { display: none; }
        .block { display: block; }
        .z-50 { z-index: 50; }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .rounded-md { border-radius: 0.375rem; }
        .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .text-sm { font-size: 0.875rem; }
        .font-medium { font-weight: 500; }
        .ring-1 { --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color); box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000); }
        .ring-black { --tw-ring-color: #000000; }
        .ring-opacity-5 { --tw-ring-color: rgba(0, 0, 0, 0.05); }
        .my-1 { margin-top: 0.25rem; margin-bottom: 0.25rem; }
        .hover\\:bg-gray-100:hover { background-color: #f3f4f6; }

        /* ì»¨í…Œì´ë„ˆ */
        .container { max-width: 800px; margin: 0 auto; padding: 0 20px; }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main { padding: 40px 0; }
        .back-link { color: #2563eb; text-decoration: none; margin-bottom: 20px; display: inline-block; }
        .back-link:hover { text-decoration: underline; }

        /* ì œëª© */
        .title { text-align: center; margin-bottom: 40px; }
        .title h1 { color: #1f2937; font-size: 2.5rem; margin-bottom: 10px; }
        .title p { color: #6b7280; font-size: 1.1rem; }

        /* ì¹´ë“œ */
        .card { background: white; border-radius: 12px; padding: 30px; margin-bottom: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }

        /* í¼ */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        @media (max-width: 768px) { .form-grid { grid-template-columns: 1fr; } }

        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #374151; }
        .form-group label .required { color: #ef4444; }

        .form-control { width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; transition: border-color 0.2s; }
        .form-control:focus { border-color: #2563eb; outline: none; box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }
        select.form-control { cursor: pointer; background: white; }
        textarea.form-control { min-height: 120px; resize: vertical; }

        /* ë²„íŠ¼ */
        .btn { display: inline-block; padding: 14px 28px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; text-decoration: none; text-align: center; transition: all 0.3s; }
        .btn-primary { background: linear-gradient(45deg, #667eea, #764ba2); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102,126,234,0.3); }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }


        /* ì•Œë¦¼ ë°•ìŠ¤ */
        .alert { padding: 16px; border-radius: 8px; margin: 20px 0; }
        .alert-warning { background: #fef3c7; border-left: 4px solid #f59e0b; color: #92400e; }
        .alert-error { background: #fee2e2; border-left: 4px solid #ef4444; color: #b91c1c; }
        .alert-info { background: #dbeafe; border-left: 4px solid #3b82f6; color: #1e40af; }

        /* ë¡œë”© */
        .loading { opacity: 0.6; pointer-events: none; }

        /* ì‹¤ì‹œê°„ ê²€ì¦ í”¼ë“œë°± */
        .validation-feedback {
            margin-top: 8px;
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 14px;
            line-height: 1.4;
        }
        .validation-feedback.error {
            background: #fee2e2;
            border-left: 4px solid #ef4444;
            color: #b91c1c;
        }
        .validation-feedback.success {
            background: #dcfce7;
            border-left: 4px solid #22c55e;
            color: #166534;
        }
        .validation-feedback.warning {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            color: #92400e;
        }
        .feedback-content {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ì…ë ¥ ê°€ì´ë“œ */
        .input-guide {
            margin-top: 12px;
            padding: 15px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
        }
        .input-guide p {
            margin: 0 0 10px 0;
            color: #374151;
            font-weight: 500;
        }
        .input-guide ul {
            margin: 0;
            padding-left: 20px;
            color: #6b7280;
        }
        .input-guide li {
            margin-bottom: 4px;
            line-height: 1.4;
        }

        /* ì…ë ¥ ìƒíƒœë³„ ìŠ¤íƒ€ì¼ */
        .form-control.error {
            border-color: #ef4444;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }
        .form-control.success {
            border-color: #22c55e;
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
        }
        .form-control.warning {
            border-color: #f59e0b;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="container">
            <a href="/" class="flex items-center space-x-1 logo">
                <div class="w-8 h-8 bg-primary-600 rounded-lg flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M9 12a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H2z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <span class="text-xl font-bold text-gray-900">SANZERO</span>
            </a>
            <!-- ì‚¬ìš©ì í”„ë¡œí•„ ë“œë¡­ë‹¤ìš´ -->
            <div class="relative">
                <button id="user-menu-button" onclick="toggleUserDropdown()" class="flex items-center space-x-2 text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2">
                    <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center">
                        <span class="text-primary-600 font-medium">T</span>
                    </div>
                    <span class="hidden md:block text-gray-700 font-medium">testuser</span>
                    <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                </button>

                <!-- ë“œë¡­ë‹¤ìš´ ë©”ë‰´ -->
                <div id="user-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 ring-1 ring-black ring-opacity-5">
                    <a href="/auth/profile" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                        <div class="flex items-center space-x-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            <span>í”„ë¡œí•„ ê´€ë¦¬</span>
                        </div>
                    </a>
                    <hr class="my-1">
                    <button onclick="handleLogout(event)" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                        <div class="flex items-center space-x-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                            </svg>
                            <span>ë¡œê·¸ì•„ì›ƒ</span>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="main">
        <div class="container">
            <!-- ë’¤ë¡œ ê°€ê¸° -->
            <a href="/" class="back-link">â† ë©”ì¸ ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</a>

            <!-- ì œëª© -->
            <div class="title">
                <h1>ğŸ”® AI ì¥í•´ë“±ê¸‰ ì˜ˆì¸¡</h1>
                <p>3ë‹¨ê³„ AI íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ì •í™•í•œ ì¥í•´ë“±ê¸‰ì„ ì˜ˆì¸¡í•©ë‹ˆë‹¤</p>
            </div>

            <!-- ì˜ˆì¸¡ í¼ -->
            <div class="card">
                <h2 style="text-align: center; margin-bottom: 30px;">ğŸ¯ ì¥í•´ë“±ê¸‰ ì˜ˆì¸¡ ì‹ ì²­</h2>

                <form method="POST" action="/analysis/disability" id="predictionForm">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token if csrf_token else 'dummy-token' }}">

                    <!-- ê¸°ë³¸ ì •ë³´ -->
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="gender">ì„±ë³„ <span class="required">*</span></label>
                            <select name="gender" id="gender" class="form-control" required>
                                <option value="1">ë‚¨ì„±</option>
                                <option value="2">ì—¬ì„±</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="age_group">ë‚˜ì´ëŒ€ <span class="required">*</span></label>
                            <select name="age_group" id="age_group" class="form-control" required>
                                <option value="1">20ëŒ€ ì´í•˜</option>
                                <option value="2">30ëŒ€</option>
                                <option value="3" selected>40ëŒ€</option>
                                <option value="4">50ëŒ€</option>
                                <option value="5">60ëŒ€</option>
                                <option value="6">70ëŒ€ ì´ìƒ</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="industry_type">ì‚°ì—… ë¶„ë¥˜ <span class="required">*</span></label>
                            <select name="industry_type" id="industry_type" class="form-control" required>
                                <option value="1">ë†ì—…/ì„ì—…/ì–´ì—…</option>
                                <option value="2" selected>ì œì¡°ì—…</option>
                                <option value="3">ê±´ì„¤ì—…</option>
                                <option value="4">ìš´ìˆ˜ì—…</option>
                                <option value="5">ì„œë¹„ìŠ¤ì—…</option>
                                <option value="6">ì‚¬ì—…ì„œë¹„ìŠ¤ì—…</option>
                                <option value="7">ë³´ê±´/ì‚¬íšŒë³µì§€ì—…</option>
                                <option value="8">ê¸°íƒ€ ì‚°ì—…</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="accident_type">ì¬í•´ ìœ í˜• <span class="required">*</span></label>
                            <select name="accident_type" id="accident_type" class="form-control" required>
                                <option value="1" selected>ì¶”ë½</option>
                                <option value="2">ì¶©ëŒ</option>
                                <option value="3">ë¼ì„</option>
                                <option value="4">ì ˆë‹¨/ë² ì„</option>
                                <option value="5">í™”ì¬/í­ë°œ</option>
                                <option value="6">êµí†µì‚¬ê³ </option>
                                <option value="7">ê¸°ê³„/ì¥ë¹„ ê´€ë ¨</option>
                                <option value="8">ê¸°íƒ€</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="body_part">ë¶€ìƒ ë¶€ìœ„ <span class="required">*</span></label>
                            <select name="body_part" id="body_part" class="form-control" required>
                                <option value="1">ë¨¸ë¦¬</option>
                                <option value="2">ëª©</option>
                                <option value="3">ê°€ìŠ´</option>
                                <option value="4">ë³µë¶€</option>
                                <option value="5" selected>íŒ”/ì–´ê¹¨</option>
                                <option value="6">ë‹¤ë¦¬/ë¬´ë¦</option>
                                <option value="7">ì†/ì†ê°€ë½</option>
                                <option value="8">ë°œ/ë°œê°€ë½</option>
                                <option value="9">í—ˆë¦¬/ì²™ì¶”</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="injury_type">ë¶€ìƒ ì¢…ë¥˜ <span class="required">*</span></label>
                            <select name="injury_type" id="injury_type" class="form-control" required>
                                <option value="1">ì ˆë‹¨</option>
                                <option value="2">ê³¨ì ˆ</option>
                                <option value="3">íƒˆêµ¬</option>
                                <option value="4" selected>ì—¼ì¢Œ</option>
                                <option value="5">íƒ€ë°•ìƒ</option>
                                <option value="6">ì°°ê³¼ìƒ</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="treatment_period">ì¹˜ë£Œ ê¸°ê°„ <span class="required">*</span></label>
                        <select name="treatment_period" id="treatment_period" class="form-control" required>
                            <option value="1">1ê°œì›” ë¯¸ë§Œ</option>
                            <option value="2">1-2ê°œì›”</option>
                            <option value="3" selected>3ê°œì›”</option>
                            <option value="4">4-6ê°œì›”</option>
                            <option value="5">6ê°œì›”-1ë…„</option>
                            <option value="6">1ë…„ ì´ìƒ</option>
                        </select>
                    </div>

                    <!-- ì¥í•´ ë‚´ìš© -->
                    <div class="form-group">
                        <label for="ì¥í•´_ë‚´ìš©">ì¥í•´ ë‚´ìš© ìƒì„¸ ì„¤ëª… <span class="required">*</span></label>
                        <textarea
                            name="ì¥í•´_ë‚´ìš©"
                            id="ì¥í•´_ë‚´ìš©"
                            class="form-control"
                            placeholder="ì˜ˆ: í”„ë ˆìŠ¤ ì‘ì—… ì¤‘ ì†ê°€ë½ ì ˆë‹¨, ê³„ë‹¨ì—ì„œ ì¶”ë½í•˜ì—¬ ë‹¤ë¦¬ ê³¨ì ˆ ë“± êµ¬ì²´ì ì¸ ì‚¬ê³  ê²½ìœ„ì™€ ë¶€ìƒ ë‚´ìš©ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”."
                            required
                        ></textarea>

                        <!-- ì‹¤ì‹œê°„ ê²€ì¦ í”¼ë“œë°± -->
                        <div id="validationFeedback" class="validation-feedback" style="display: none;">
                            <div class="feedback-content">
                                <span id="feedbackIcon">âš ï¸</span>
                                <span id="feedbackMessage">ì¥í•´ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>
                            </div>
                        </div>

                        <!-- ì…ë ¥ ê°€ì´ë“œ -->
                        <div class="input-guide">
                            <p><strong>ì…ë ¥ ì˜ˆì‹œ:</strong></p>
                            <ul>
                                <li>í”„ë ˆìŠ¤ ì‘ì—… ì¤‘ ì†ê°€ë½ ì ˆë‹¨</li>
                                <li>ì‚¬ë‹¤ë¦¬ì—ì„œ ì¶”ë½í•˜ì—¬ í—ˆë¦¬ ì²™ì¶” ì†ìƒ</li>
                                <li>í™”í•™ë¬¼ì§ˆ ë…¸ì¶œë¡œ ì¸í•œ í˜¸í¡ê¸° ì§ˆí™˜</li>
                                <li>ë°˜ë³µì‘ì—…ìœ¼ë¡œ ì¸í•œ ì†ëª© ê·¼ê³¨ê²©ê³„ ì§ˆí™˜</li>
                            </ul>
                        </div>
                    </div>

                    <!-- ì œì¶œ ë²„íŠ¼ -->
                    <div style="text-align: center; margin-top: 30px;">
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            ğŸ“ ì¥í•´ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”
                        </button>
                    </div>
                </form>
            </div>

        </div>
    </main>

    <script>
        // ì‹¤ì‹œê°„ ì…ë ¥ ê²€ì¦
        function validateInjuryDescription(text) {
            if (!text || text.trim().length === 0) {
                return {
                    valid: false,
                    type: 'warning',
                    icon: 'ğŸ“',
                    message: 'ì¥í•´ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'
                };
            }

            const trimmedText = text.trim();

            // ìµœì†Œ ê¸¸ì´ í™•ì¸
            if (trimmedText.length < 5) {
                return {
                    valid: false,
                    type: 'error',
                    icon: 'âš ï¸',
                    message: 'ìµœì†Œ 5ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.'
                };
            }

            // ë¬´ì˜ë¯¸í•œ ë°˜ë³µ ë¬¸ì ê°ì§€
            if (isMeaninglessText(trimmedText)) {
                return {
                    valid: false,
                    type: 'error',
                    icon: 'âŒ',
                    message: 'ì˜ë¯¸ìˆëŠ” ì¥í•´ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. ë‹¨ìˆœ ë°˜ë³µ ë¬¸ìëŠ” í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'
                };
            }

            // ì‚°ì—…ì¬í•´ ê´€ë ¨ í‚¤ì›Œë“œ í™•ì¸
            if (!containsInjuryKeywords(trimmedText)) {
                return {
                    valid: false,
                    type: 'error',
                    icon: 'ğŸ”',
                    message: 'ì‚°ì—…ì¬í•´ì™€ ê´€ë ¨ëœ êµ¬ì²´ì ì¸ ë¶€ìƒì´ë‚˜ ì‚¬ê³  ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'
                };
            }

            return {
                valid: true,
                type: 'success',
                icon: 'âœ…',
                message: 'ì…ë ¥ ì™„ë£Œ! ì˜ˆì¸¡ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.'
            };
        }

        function isMeaninglessText(text) {
            const lowerText = text.toLowerCase();

            // ê°™ì€ ë¬¸ìê°€ 50% ì´ìƒ ë°˜ë³µë˜ëŠ” ê²½ìš°
            if (text.length > 4) {
                const charCounts = {};
                for (const char of lowerText) {
                    charCounts[char] = (charCounts[char] || 0) + 1;
                }
                const maxCount = Math.max(...Object.values(charCounts));
                if (maxCount / text.length > 0.5) return true;
            }

            // ì—°ì†ëœ ê°™ì€ ë¬¸ìê°€ 4ê°œ ì´ìƒì¸ ê²½ìš°
            for (let i = 0; i < lowerText.length - 3; i++) {
                if (lowerText[i] === lowerText[i+1] &&
                    lowerText[i] === lowerText[i+2] &&
                    lowerText[i] === lowerText[i+3]) {
                    return true;
                }
            }

            // ìˆ«ìë§Œìœ¼ë¡œ ì´ë£¨ì–´ì§„ ê²½ìš°
            if (/^\d+$/.test(text)) return true;

            // íŠ¹ìˆ˜ë¬¸ìë§Œìœ¼ë¡œ ì´ë£¨ì–´ì§„ ê²½ìš°
            if (/^[^\w\sê°€-í£]+$/.test(text)) return true;

            return false;
        }

        function containsInjuryKeywords(text) {
            const lowerText = text.toLowerCase();

            const injuryKeywords = [
                // ì‹ ì²´ ë¶€ìœ„
                'ë¨¸ë¦¬', 'ëª©', 'ê°€ìŠ´', 'ë³µë¶€', 'íŒ”', 'ì–´ê¹¨', 'ì†', 'ì†ê°€ë½', 'ë‹¤ë¦¬', 'ë¬´ë¦', 'ë°œ', 'ë°œê°€ë½',
                'í—ˆë¦¬', 'ì²™ì¶”', 'ë“±', 'ì—‰ë©ì´', 'ê³¨ë°˜',
                // ë¶€ìƒ ìœ í˜•
                'ì ˆë‹¨', 'ê³¨ì ˆ', 'íƒˆêµ¬', 'ì—¼ì¢Œ', 'íƒ€ë°•ìƒ', 'ì°°ê³¼ìƒ', 'í™”ìƒ', 'ë™ìƒ', 'ê°ì „', 'ì§ˆì‹',
                'ì¤‘ë…', 'ë¶€ìƒ', 'ìƒí•´', 'ì™¸ìƒ', 'ì†ìƒ', 'ë² ì„', 'ë¼ì„', 'ê¹”ë¦¼', 'ë§ìŒ',
                // ì˜ë£Œ ìš©ì–´
                'ìˆ˜ìˆ ', 'ì¹˜ë£Œ', 'ì…ì›', 'í†µì¦', 'ì•„í””', 'ë§ˆë¹„', 'ì¥ì• ', 'ì¬í™œ', 'íšŒë³µ', 'ì§„ë‹¨',
                'ê²€ì‚¬', 'ì´¬ì˜', 'ë´‰í•©', 'ê¹ìŠ¤', 'ë¶•ëŒ€',
                // ì‚¬ê³  ìƒí™©
                'ì‘ì—…', 'ê·¼ë¬´', 'ì—…ë¬´', 'ì¼í•˜ë‹¤', 'ì¶”ë½', 'ë„˜ì–´ì§', 'ë¯¸ë„ëŸ¬ì§', 'ì¶©ëŒ', 'í­ë°œ',
                'í™”ì¬', 'ê¸°ê³„', 'ì¥ë¹„', 'ë„êµ¬', 'ì‚¬ë‹¤ë¦¬', 'ë¹„ê³„', 'í¬ë ˆì¸', 'ì§€ê²Œì°¨', 'í”„ë ˆìŠ¤',
                // ì‘ì—…ì¥ ê´€ë ¨
                'ê³µì¥', 'ê±´ì„¤í˜„ì¥', 'ì‚¬ë¬´ì‹¤', 'ì°½ê³ ', 'ì‘ì—…ì¥', 'í˜„ì¥', 'ê¸°ì—…', 'íšŒì‚¬',
                // ì¼ë°˜ì ì¸ í•œê¸€ ë‹¨ì–´
                'ì¤‘', 'ë•Œ', 'í•˜ë‹¤', 'ë˜ë‹¤', 'ìˆë‹¤', 'ì—†ë‹¤', 'í›„', 'ì „', 'ë™ì•ˆ', 'ìœ¼ë¡œ', 'ì—ì„œ', 'ì—ê²Œ',
                'ì™€', 'ê³¼', 'ë¥¼', 'ì„', 'ê°€', 'ì´', 'ëŠ”', 'ì€', 'ì˜', 'ë¡œ', 'ì—'
            ];

            // í‚¤ì›Œë“œ ì¤‘ í•˜ë‚˜ë¼ë„ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ true
            for (const keyword of injuryKeywords) {
                if (lowerText.includes(keyword)) return true;
            }

            // í•œê¸€ì´ ì „í˜€ í¬í•¨ë˜ì§€ ì•Šì€ ê²½ìš°ë„ ë¬´íš¨
            const hasKorean = /[ê°€-í£]/.test(text);
            return hasKorean;
        }

        function updateValidationUI(validation) {
            const feedbackElement = document.getElementById('validationFeedback');
            const iconElement = document.getElementById('feedbackIcon');
            const messageElement = document.getElementById('feedbackMessage');
            const textareaElement = document.getElementById('ì¥í•´_ë‚´ìš©');
            const submitBtn = document.getElementById('submitBtn');

            // í”¼ë“œë°± í‘œì‹œ/ìˆ¨ê¹€
            if (validation.valid || validation.type === 'warning') {
                feedbackElement.style.display = 'block';
                feedbackElement.className = `validation-feedback ${validation.type}`;
                iconElement.textContent = validation.icon;
                messageElement.textContent = validation.message;
            } else {
                feedbackElement.style.display = 'block';
                feedbackElement.className = `validation-feedback ${validation.type}`;
                iconElement.textContent = validation.icon;
                messageElement.textContent = validation.message;
            }

            // ì…ë ¥ë€ ìŠ¤íƒ€ì¼ ë³€ê²½
            textareaElement.className = `form-control ${validation.type}`;

            // ì œì¶œ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
            submitBtn.disabled = !validation.valid;
            if (!validation.valid) {
                submitBtn.style.opacity = '0.6';
                submitBtn.style.cursor = 'not-allowed';
                if (validation.type === 'warning') {
                    submitBtn.innerHTML = 'ğŸ“ ì¥í•´ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”';
                } else {
                    submitBtn.innerHTML = 'âŒ ì…ë ¥ì„ í™•ì¸í•´ì£¼ì„¸ìš”';
                }
            } else {
                submitBtn.style.opacity = '1';
                submitBtn.style.cursor = 'pointer';
                submitBtn.innerHTML = 'ğŸ”® ì¥í•´ë“±ê¸‰ ì˜ˆì¸¡í•˜ê¸°';
            }
        }

        // í¼ ì œì¶œ ì²˜ë¦¬
        document.getElementById('predictionForm').addEventListener('submit', function(e) {
            const submitBtn = document.getElementById('submitBtn');
            const injuryDescription = document.getElementById('ì¥í•´_ë‚´ìš©').value.trim();

            // ìµœì¢… ê²€ì¦
            const validation = validateInjuryDescription(injuryDescription);
            if (!validation.valid) {
                e.preventDefault();
                updateValidationUI(validation);
                return;
            }

            // ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™”
            submitBtn.disabled = true;
            submitBtn.innerHTML = 'ğŸ”„ ì˜ˆì¸¡ ì¤‘...';
            submitBtn.classList.add('loading');
        });

        // ì‹¤ì‹œê°„ ì…ë ¥ ê²€ì¦ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.addEventListener('DOMContentLoaded', function() {
            const textareaElement = document.getElementById('ì¥í•´_ë‚´ìš©');

            // ì´ˆê¸° ìƒíƒœ ì„¤ì • (ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™”)
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.style.opacity = '0.6';
            submitBtn.style.cursor = 'not-allowed';

            // ì…ë ¥ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ì‹¤ì‹œê°„ ê²€ì¦)
            textareaElement.addEventListener('input', function() {
                const text = this.value;
                const validation = validateInjuryDescription(text);
                updateValidationUI(validation);
            });

            // í¬ì»¤ìŠ¤ ì•„ì›ƒ ì‹œì—ë„ ê²€ì¦
            textareaElement.addEventListener('blur', function() {
                const text = this.value;
                const validation = validateInjuryDescription(text);
                updateValidationUI(validation);
            });
        });

        // í…ŒìŠ¤íŠ¸ìš© ë°ì´í„° ìë™ ì…ë ¥ (ë²ˆë“¤ ê°€ì´ë“œ ì˜ˆì‹œ)
        function fillTestData() {
            document.getElementById('body_part').value = '7';  // ì†
            document.getElementById('injury_type').value = '1';  // ì ˆë‹¨
            document.getElementById('treatment_period').value = '2';  // 1-2ê°œì›”
            document.getElementById('ì¥í•´_ë‚´ìš©').value = 'í”„ë ˆìŠ¤ ì‘ì—… ì¤‘ ì†ê°€ë½ ì ˆë‹¨';

            // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì…ë ¥ í›„ ê²€ì¦ ì‹¤í–‰
            const validation = validateInjuryDescription('í”„ë ˆìŠ¤ ì‘ì—… ì¤‘ ì†ê°€ë½ ì ˆë‹¨');
            updateValidationUI(validation);
        }

        // ì‚¬ìš©ì ë“œë¡­ë‹¤ìš´ ë©”ë‰´ í† ê¸€
        function toggleUserDropdown() {
            const dropdown = document.getElementById('user-dropdown');
            dropdown.classList.toggle('hidden');
        }

        // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
        async function handleLogout(event) {
            event.preventDefault();

            try {
                const response = await fetch('/auth/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'same-origin'
                });

                if (response.ok) {
                    window.location.href = '/auth/login';
                } else {
                    console.error('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜:', error);
            }
        }

        // í˜ì´ì§€ ì™¸ë¶€ í´ë¦­ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('user-dropdown');
            const button = document.getElementById('user-menu-button');

            if (!button.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.classList.add('hidden');
            }
        });

        // í˜ì´ì§€ ë¡œë“œ í›„ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìë™ ì…ë ¥ (ê°œë°œìš©)
        window.addEventListener('load', function() {
            // fillTestData(); // ì£¼ì„ í•´ì œí•˜ë©´ ìë™ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì…ë ¥ë¨
        });
    </script>
</body>
</html>