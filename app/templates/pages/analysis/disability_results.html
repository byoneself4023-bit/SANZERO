{% extends "base.html" %}

{% block title %}ì¥í•´ë“±ê¸‰ ì˜ˆì¸¡ ê²°ê³¼ - SANZERO{% endblock %}

{% block extra_head %}
<meta name="description" content="{{ description }}">
<!-- ì¥í•´ë“±ê¸‰ ì˜ˆì¸¡ ê²°ê³¼ ì „ìš© ìŠ¤íƒ€ì¼ (disability.htmlê³¼ ë™ì¼í•œ ë””ìì¸) -->
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; line-height: 1.6; color: #333; }
.container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
.btn { background: #2563eb; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; text-decoration: none; display: inline-block; font-weight: 500; transition: background 0.3s; }
.btn:hover { background: #1d4ed8; }
.btn-primary { background: linear-gradient(45deg, #667eea, #764ba2); }
.btn-orange { background: #ea580c; }
.card { background: white; border-radius: 12px; padding: 24px; margin: 16px 0; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
.text-center { text-align: center; }
.text-red { color: #dc2626; }
.bg-warning { background: #fef3c7; border-left: 4px solid #f59e0b; padding: 16px; border-radius: 6px; margin: 16px 0; }

/* ê²°ê³¼ í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ */
.result-card {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 16px;
    padding: 2rem;
    color: #1f2937;
    margin-bottom: 2rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.grade-display {
    font-size: 4rem;
    font-weight: bold;
    margin: 1rem 0;
}

.grade-1-3 { color: #ef4444; }    /* ë¹¨ê°• - ì¤‘ì¦ */
.grade-4-7 { color: #f59e0b; }    /* ì£¼í™© - ì¤‘ë“±ë„ */
.grade-8-12 { color: #10b981; }   /* ì´ˆë¡ - ê²½ë„ */
.grade-13-15 { color: #3b82f6; }  /* íŒŒë‘ - ê²½ë¯¸ */

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
    margin: 1.5rem 0;
}

.info-card {
    background: #f8f9ff;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 1.5rem;
    text-align: center;
}

.info-card h4 {
    margin: 0 0 0.5rem 0;
    color: #4a5568;
    font-size: 0.9rem;
    font-weight: 600;
}

.info-card p {
    margin: 0;
    color: #718096;
    font-size: 0.8rem;
    line-height: 1.4;
}

.prediction-method {
    background: #f3f4f6;
    border: 1px solid #d1d5db;
    padding: 1rem;
    border-radius: 8px;
    margin: 1rem 0;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 500;
    color: #374151;
}

.action-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
    margin: 2rem 0;
}

.action-button {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.action-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
}

.btn-calc {
    background: linear-gradient(45deg, #ff6b6b, #ffa726);
    color: white;
}

.btn-retry {
    background: white;
    color: #2563eb;
    border: 2px solid #2563eb;
}

@media (max-width: 768px) {
    .grade-display {
        font-size: 3rem;
    }

    .info-grid {
        grid-template-columns: 1fr;
        gap: 0.8rem;
    }

    .action-buttons {
        flex-direction: column;
        align-items: center;
    }

    .action-button {
        width: 100%;
        max-width: 280px;
        justify-content: center;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-6xl">
    <!-- ë’¤ë¡œ ê°€ê¸° ë²„íŠ¼ -->
    <div class="mb-6">
        <a href="/" class="inline-flex items-center text-blue-600 hover:text-blue-800 transition-colors">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            ë©”ì¸ ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
        </a>
    </div>

    <!-- í˜ì´ì§€ í—¤ë” -->
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-800 mb-4">ğŸ¯ AI ì¥í•´ë“±ê¸‰ ì˜ˆì¸¡ ê²°ê³¼</h1>
        <p class="text-xl text-gray-600">3ë‹¨ê³„ AI íŒŒì´í”„ë¼ì¸ ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</p>
    </div>

    <!-- ì˜ˆì¸¡ ê²°ê³¼ ë©”ì¸ ì¹´ë“œ -->
    <div class="result-card text-center">
        <div id="resultDisplay">
            <!-- ê²°ê³¼ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤ -->
            <div class="text-xl opacity-80 mb-4">ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>

        <!-- ì˜ˆì¸¡ ë°©ë²• í‘œì‹œ -->
        <div class="prediction-method" id="predictionMethod" style="display: none;">
            <span id="sourceIcon">ğŸ”</span>
            <span id="sourceText">ì˜ˆì¸¡ ë°©ë²•</span>
        </div>
    </div>

    <!-- ì¤‘ìš” ì•ˆë‚´ -->
    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-6 mb-8 rounded-r-lg">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
            </div>
            <div class="ml-3">
                <h3 class="text-sm font-medium text-yellow-800">âš ï¸ ì¤‘ìš”í•œ ì£¼ì˜ì‚¬í•­</h3>
                <p class="mt-2 text-sm text-yellow-700">
                    ì´ ì˜ˆì¸¡ ê²°ê³¼ëŠ” AI ë¶„ì„ì„ í†µí•œ <strong>ì°¸ê³ ìš© ì •ë³´</strong>ì…ë‹ˆë‹¤.
                    ì‹¤ì œ ì¥í•´ë“±ê¸‰ì€ ì˜ë£Œì§„ì˜ ì •ë°€ ì§„ë‹¨ê³¼ ì‚°ì¬ë³´í—˜ ì‹¬ì‚¬ìœ„ì›íšŒì˜ ì¢…í•©ì ì¸ ê²€í† ë¥¼ í†µí•´ ê²°ì •ë©ë‹ˆë‹¤.
                    ì •í™•í•œ ì§„ë‹¨ê³¼ ë“±ê¸‰ ê²°ì •ì„ ìœ„í•´ì„œëŠ” ë°˜ë“œì‹œ ì˜ë£Œì§„ê³¼ ìƒë‹´í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
                </p>
            </div>
        </div>
    </div>

    <!-- ì˜ˆì¸¡ ì •ë³´ ì¹´ë“œë“¤ -->
    <div class="result-card">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">â„¹ï¸ ì˜ˆì¸¡ ìƒì„¸ ì •ë³´</h2>

        <div class="info-grid">
            <div class="info-card">
                <h4>ì˜ˆì¸¡ ë“±ê¸‰</h4>
                <p id="gradeDetail">ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
            <div class="info-card">
                <h4>ì˜ˆì¸¡ ë°©ë²•</h4>
                <p id="methodDetail">ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
            <div class="info-card">
                <h4>ì‹ ë¢°ë„</h4>
                <p id="confidenceDetail">ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
            <div class="info-card">
                <h4>ì˜ˆì¸¡ ê·¼ê±°</h4>
                <p id="explanationDetail">ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
        </div>
    </div>

    <!-- ë‹¤ìŒ ë‹¨ê³„ ì•ˆë‚´ -->
    <div class="action-buttons">
        <button onclick="goToCompensationWithGrade()" class="action-button btn-calc" id="compensationBtn">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
            </svg>
            ë³´ìƒê¸ˆ ê³„ì‚°í•˜ê¸°
        </button>
        <a href="/analysis/disability" class="action-button btn-retry">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
            ë‹¤ì‹œ ì˜ˆì¸¡í•˜ê¸°
        </a>
    </div>
</div>

<script>
// URL íŒŒë¼ë¯¸í„°ì—ì„œ ê²°ê³¼ ë°ì´í„° ì¶”ì¶œ
const urlParams = new URLSearchParams(window.location.search);
const grade = urlParams.get('grade');
const source = urlParams.get('source');
const confidence = urlParams.get('confidence');
const message = urlParams.get('message');

console.log('ì˜ˆì¸¡ ê²°ê³¼ íŒŒë¼ë¯¸í„°:', { grade, source, confidence, message });

function displayResult() {
    const resultDisplay = document.getElementById('resultDisplay');
    const predictionMethod = document.getElementById('predictionMethod');

    if (grade && grade !== 'N/A' && grade !== 'null') {
        // ë“±ê¸‰ë³„ ìŠ¤íƒ€ì¼ í´ë˜ìŠ¤ ê²°ì •
        let gradeClass = '';
        const gradeNum = parseInt(grade);
        if (gradeNum <= 3) gradeClass = 'grade-1-3';
        else if (gradeNum <= 7) gradeClass = 'grade-4-7';
        else if (gradeNum <= 12) gradeClass = 'grade-8-12';
        else gradeClass = 'grade-13-15';

        // ê²°ê³¼ í‘œì‹œ
        resultDisplay.innerHTML = `
            <div class="grade-display ${gradeClass}">${grade}ê¸‰</div>
            <p class="text-xl mb-4">${message || `ì¥í•´ë“±ê¸‰ ${grade}ê¸‰ìœ¼ë¡œ ì˜ˆì¸¡ë©ë‹ˆë‹¤`}</p>
        `;

        // ì˜ˆì¸¡ ë°©ë²• í‘œì‹œ
        if (source) {
            const sourceIcon = getSourceIcon(source);
            const sourceText = getSourceText(source);
            document.getElementById('sourceIcon').textContent = sourceIcon;
            document.getElementById('sourceText').textContent = sourceText;
            predictionMethod.style.display = 'inline-flex';
        }

        // ìƒì„¸ ì •ë³´ ì—…ë°ì´íŠ¸
        updateDetailCards(grade, source, confidence, message);

    } else {
        // ì˜¤ë¥˜ í‘œì‹œ
        resultDisplay.innerHTML = `
            <div class="text-2xl text-red-600 mb-4">âŒ ì˜ˆì¸¡ ì‹¤íŒ¨</div>
            <p class="text-lg text-gray-700">${message || 'ì˜ˆì¸¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤'}</p>
        `;

        // ì˜¤ë¥˜ ìƒì„¸ ì •ë³´
        updateDetailCards(null, source, null, message);
    }
}

function getSourceIcon(source) {
    const icons = {
        'exact_match': 'ğŸ¯',
        'similarity_match': 'ğŸ§ ',
        'regression_model': 'âš™ï¸',
        'fallback': 'ğŸ”',
        'error': 'âŒ'
    };
    return icons[source] || 'ğŸ”';
}

function getSourceText(source) {
    const texts = {
        'exact_match': 'ì •í™• ë¬¸êµ¬ ë§¤ì¹­',
        'similarity_match': 'BERT ìœ ì‚¬ë„ ë§¤ì¹­',
        'regression_model': '2-Stage ë¨¸ì‹ ëŸ¬ë‹',
        'fallback': 'ê·œì¹™ ê¸°ë°˜ ì˜ˆì¸¡',
        'error': 'ì˜ˆì¸¡ ì˜¤ë¥˜'
    };
    return texts[source] || 'ì•Œ ìˆ˜ ì—†ìŒ';
}

function updateDetailCards(grade, source, confidence, message) {
    // ì˜ˆì¸¡ ë“±ê¸‰
    const gradeText = grade ?
        `${grade}ê¸‰ (${getGradeDescription(parseInt(grade))})` :
        'ì˜ˆì¸¡ ì‹¤íŒ¨';
    document.getElementById('gradeDetail').textContent = gradeText;

    // ì˜ˆì¸¡ ë°©ë²•
    const methodText = source ? getSourceText(source) : 'ì•Œ ìˆ˜ ì—†ìŒ';
    document.getElementById('methodDetail').textContent = methodText;

    // ì‹ ë¢°ë„
    const confidenceText = confidence ?
        `${Math.round(parseFloat(confidence) * 100)}%` :
        'ì •ë³´ ì—†ìŒ';
    document.getElementById('confidenceDetail').textContent = confidenceText;

    // ì˜ˆì¸¡ ê·¼ê±°
    const explanationText = message || 'ì˜ˆì¸¡ ê·¼ê±° ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.';
    document.getElementById('explanationDetail').textContent = explanationText;
}

function getGradeDescription(grade) {
    if (grade <= 3) return 'ì¤‘ì¦ ì¥ì• ';
    if (grade <= 7) return 'ì¤‘ë“±ë„ ì¥ì• ';
    if (grade <= 12) return 'ê²½ë„ ì¥ì• ';
    return 'ê²½ë¯¸í•œ ì¥ì• ';
}

// ë³´ìƒê¸ˆ ê³„ì‚°ìœ¼ë¡œ ì´ë™í•˜ëŠ” í•¨ìˆ˜
function goToCompensationWithGrade() {
    const grade = urlParams.get('grade');

    if (grade && grade !== 'N/A' && grade !== 'null') {
        // ì¥í•´ë“±ê¸‰ ì •ë³´ì™€ í•¨ê»˜ ë³´ìƒê¸ˆ ê³„ì‚° í˜ì´ì§€ë¡œ ì´ë™
        const params = new URLSearchParams({
            disability_grade: grade,
            from_prediction: 'true'
        });

        console.log(`ğŸ¯ ì¥í•´ë“±ê¸‰ ${grade}ê¸‰ê³¼ í•¨ê»˜ ë³´ìƒê¸ˆ ê³„ì‚° í˜ì´ì§€ë¡œ ì´ë™`);
        window.location.href = `/compensation/calculate?${params.toString()}`;
    } else {
        // ì˜ˆì¸¡ ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ì¼ë°˜ ë³´ìƒê¸ˆ ê³„ì‚° í˜ì´ì§€ë¡œ ì´ë™
        console.log('âš ï¸ ì˜ˆì¸¡ ê²°ê³¼ ì—†ìŒ, ì¼ë°˜ ë³´ìƒê¸ˆ ê³„ì‚° í˜ì´ì§€ë¡œ ì´ë™');
        window.location.href = '/compensation/calculate';
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ê²°ê³¼ í‘œì‹œ
document.addEventListener('DOMContentLoaded', function() {
    console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ, ê²°ê³¼ í‘œì‹œ ì‹œì‘');
    displayResult();
});
</script>
{% endblock %}