{% extends "base.html" %}

{% block title %}보상금 신청서 작성 - SANZERO{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
    <!-- 페이지 헤더 -->
    <div class="mb-8">
        <nav class="text-sm breadcrumbs mb-4">
            <a href="/compensation" class="text-blue-600 hover:text-blue-800">보상금 서비스</a>
            <span class="mx-2 text-gray-400">></span>
            <span class="text-gray-600">신청서 작성</span>
        </nav>
        <h1 class="text-3xl font-bold text-gray-900 mb-2">산재 보상금 신청서 작성</h1>
        <p class="text-gray-600">정확한 정보를 입력하여 산업재해 보상금을 신청해주세요</p>
    </div>

    <!-- 에러 메시지 표시 -->
    {% if error_message %}
    <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
        <div class="flex items-start">
            <svg class="h-5 w-5 text-red-600 mt-0.5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div class="text-sm text-red-800">{{ error_message }}</div>
        </div>
    </div>
    {% endif %}

    <!-- 신청서 폼 -->
    <form method="POST" action="/compensation/apply" class="space-y-8">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

        <!-- 기본 사고 정보 -->
        <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">사고 정보</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- 사고 발생일 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        사고 발생일 <span class="text-red-500">*</span>
                    </label>
                    <input type="date" name="incident_date" class="form-input w-full" required
                           value="{{ form_data.incident_date if form_data else '' }}"
                           max="{{ today }}">
                    <p class="text-xs text-gray-500 mt-1">실제 사고가 발생한 날짜를 입력하세요</p>
                </div>

                <!-- 부상 유형 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        부상 유형 <span class="text-red-500">*</span>
                    </label>
                    <select name="injury_type" class="form-select w-full" required>
                        <option value="">선택해주세요</option>
                        <option value="절단" {{ 'selected' if form_data and form_data.injury_type == '절단' else '' }}>절단</option>
                        <option value="골절" {{ 'selected' if form_data and form_data.injury_type == '골절' else '' }}>골절</option>
                        <option value="타박상" {{ 'selected' if form_data and form_data.injury_type == '타박상' else '' }}>타박상</option>
                        <option value="염좌" {{ 'selected' if form_data and form_data.injury_type == '염좌' else '' }}>염좌</option>
                        <option value="화상" {{ 'selected' if form_data and form_data.injury_type == '화상' else '' }}>화상</option>
                        <option value="추락상해" {{ 'selected' if form_data and form_data.injury_type == '추락상해' else '' }}>추락상해</option>
                        <option value="기타" {{ 'selected' if form_data and form_data.injury_type == '기타' else '' }}>기타</option>
                    </select>
                </div>

                <!-- 심각도 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        부상 심각도 <span class="text-red-500">*</span>
                    </label>
                    <select name="severity_level" class="form-select w-full" required>
                        <option value="">선택해주세요</option>
                        <option value="minor" {{ 'selected' if form_data and form_data.severity_level == 'minor' else '' }}>경미 (1주 이내 회복)</option>
                        <option value="moderate" {{ 'selected' if form_data and form_data.severity_level == 'moderate' else '' }}>보통 (1-4주 치료)</option>
                        <option value="severe" {{ 'selected' if form_data and form_data.severity_level == 'severe' else '' }}>심각 (1개월 이상 치료)</option>
                        <option value="critical" {{ 'selected' if form_data and form_data.severity_level == 'critical' else '' }}>위험 (영구 장해 가능성)</option>
                    </select>
                </div>
            </div>

            <!-- 사고 장소 -->
            <div class="mt-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    사고 발생 장소 <span class="text-red-500">*</span>
                </label>
                <input type="text" name="incident_location" class="form-input w-full" required
                       placeholder="예: 서울시 강남구 테헤란로 123, ABC빌딩 3층 생산실"
                       value="{{ form_data.incident_location if form_data else '' }}">
                <p class="text-xs text-gray-500 mt-1">상세한 주소와 구체적인 장소를 입력하세요</p>
            </div>

            <!-- 사고 경위 -->
            <div class="mt-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    사고 경위 및 상황 <span class="text-red-500">*</span>
                </label>
                <textarea name="incident_description" rows="5" class="form-textarea w-full" required
                          placeholder="사고 발생 경위, 상황, 원인 등을 자세히 기술해주세요..."
                >{{ form_data.incident_description if form_data else '' }}</textarea>
                <p class="text-xs text-gray-500 mt-1">최소 20자 이상 상세히 작성해주세요</p>
            </div>
        </div>

        <!-- 의료 정보 -->
        <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">의료 정보</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- 병원명 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">병원명</label>
                    <input type="text" name="hospital_name" class="form-input w-full"
                           placeholder="예: 삼성서울병원"
                           value="{{ form_data.medical_records.hospital if form_data and form_data.medical_records else '' }}">
                </div>

                <!-- 진단명 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">진단명</label>
                    <input type="text" name="diagnosis" class="form-input w-full"
                           placeholder="예: 우측 발목 염좌"
                           value="{{ form_data.medical_records.diagnosis if form_data and form_data.medical_records else '' }}">
                </div>

                <!-- 치료 기간 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">치료 기간</label>
                    <input type="text" name="treatment_period" class="form-input w-full"
                           placeholder="예: 4주"
                           value="{{ form_data.medical_records.treatment_period if form_data and form_data.medical_records else '' }}">
                </div>

                <!-- 의료비 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">의료비</label>
                    <input type="number" name="medical_cost" class="form-input w-full"
                           placeholder="예: 500000" min="0" step="1000"
                           value="{{ form_data.medical_records.medical_cost if form_data and form_data.medical_records else '' }}"
                           onchange="formatCurrency(this)">
                    <p class="text-xs text-gray-500 mt-1">총 의료비를 원 단위로 입력하세요</p>
                </div>
            </div>
        </div>

        <!-- 고용 정보 -->
        <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">고용 정보</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- 회사명 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">회사명</label>
                    <input type="text" name="company_name" class="form-input w-full"
                           placeholder="예: (주)테스트컴퍼니"
                           value="{{ form_data.employment_info.company if form_data and form_data.employment_info else '' }}">
                </div>

                <!-- 직위/직책 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">직위/직책</label>
                    <input type="text" name="position" class="form-input w-full"
                           placeholder="예: 생산직, 대리, 부장 등"
                           value="{{ form_data.employment_info.position if form_data and form_data.employment_info else '' }}">
                </div>

                <!-- 고용 형태 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">고용 형태</label>
                    <select name="employment_type" class="form-select w-full">
                        <option value="">선택해주세요</option>
                        <option value="정규직" {{ 'selected' if form_data and form_data.employment_info and form_data.employment_info.employment_type == '정규직' else '' }}>정규직</option>
                        <option value="계약직" {{ 'selected' if form_data and form_data.employment_info and form_data.employment_info.employment_type == '계약직' else '' }}>계약직</option>
                        <option value="파견직" {{ 'selected' if form_data and form_data.employment_info and form_data.employment_info.employment_type == '파견직' else '' }}>파견직</option>
                        <option value="일용직" {{ 'selected' if form_data and form_data.employment_info and form_data.employment_info.employment_type == '일용직' else '' }}>일용직</option>
                    </select>
                </div>

                <!-- 입사일 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">입사일</label>
                    <input type="date" name="work_start_date" class="form-input w-full"
                           value="{{ form_data.employment_info.work_start_date if form_data and form_data.employment_info else '' }}">
                </div>
            </div>
        </div>

        <!-- 급여 정보 -->
        <div class="bg-white rounded-lg shadow-md border border-gray-200 p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">급여 정보</h2>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- 기본 급여 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">기본 급여 (월)</label>
                    <input type="number" name="base_salary" class="form-input w-full"
                           placeholder="예: 3500000" min="0" step="10000"
                           value="{{ form_data.salary_info.base_salary if form_data and form_data.salary_info else '' }}"
                           onchange="formatCurrency(this)">
                    <p class="text-xs text-gray-500 mt-1">월 기본급을 입력하세요</p>
                </div>

                <!-- 월 수당 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">월 수당</label>
                    <input type="number" name="monthly_bonus" class="form-input w-full"
                           placeholder="예: 200000" min="0" step="10000"
                           value="{{ form_data.salary_info.monthly_bonus if form_data and form_data.salary_info else '' }}"
                           onchange="formatCurrency(this)">
                    <p class="text-xs text-gray-500 mt-1">각종 수당 합계</p>
                </div>

                <!-- 연봉 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">연봉</label>
                    <input type="number" name="annual_salary" class="form-input w-full"
                           placeholder="예: 50000000" min="0" step="100000"
                           value="{{ form_data.salary_info.annual_salary if form_data and form_data.salary_info else '' }}"
                           onchange="formatCurrency(this)">
                    <p class="text-xs text-gray-500 mt-1">세전 연봉 총액</p>
                </div>
            </div>

            <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <div class="flex items-start">
                    <svg class="h-5 w-5 text-blue-600 mt-0.5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <div class="text-sm text-blue-800">
                        <p><strong>급여 정보 입력 팁:</strong></p>
                        <ul class="mt-1 list-disc list-inside">
                            <li>정확한 보상금 계산을 위해 최대한 정확히 입력해주세요</li>
                            <li>기본급에는 고정적으로 지급되는 급여만 포함하세요</li>
                            <li>수당에는 연장근무수당, 야간수당, 각종 수당을 포함하세요</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- 제출 버튼 -->
        <div class="text-center space-y-4">
            <button type="submit" class="bg-green-600 text-white px-8 py-3 rounded-lg hover:bg-green-700 transition-colors font-medium">
                <svg class="h-5 w-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                신청서 제출
            </button>

            <div class="flex justify-center space-x-4">
                <a href="/compensation" class="text-gray-600 hover:text-gray-800 text-sm">취소</a>
                <a href="/compensation/calculator" class="text-blue-600 hover:text-blue-800 text-sm">보상금 미리 계산해보기</a>
            </div>
        </div>
    </form>

    <!-- 주의사항 -->
    <div class="mt-8 bg-yellow-50 border border-yellow-200 rounded-lg p-6">
        <h3 class="text-lg font-semibold text-yellow-900 mb-3">신청 시 주의사항</h3>
        <ul class="text-sm text-yellow-800 space-y-2">
            <li>• <strong>정확한 정보 입력:</strong> 허위 정보 입력 시 신청이 거부될 수 있습니다.</li>
            <li>• <strong>필수 서류:</strong> 신청 후 의료진단서, 재해경위서 등 추가 서류를 요청할 수 있습니다.</li>
            <li>• <strong>처리 기간:</strong> 신청서 검토에는 보통 7-14일이 소요됩니다.</li>
            <li>• <strong>수정/취소:</strong> 제출 후 대기 상태에서만 수정 및 취소가 가능합니다.</li>
            <li>• <strong>문의사항:</strong> 추가 도움이 필요하시면 AI 챗봇이나 노무사 상담을 이용하세요.</li>
        </ul>
    </div>
</div>

<script>
// 숫자 천단위 콤마 추가
function formatCurrency(input) {
    let value = input.value.replace(/,/g, '');
    if (value && !isNaN(value)) {
        input.value = parseInt(value).toLocaleString();
    }
}

// 폼 제출 전 숫자 형식 정리
document.querySelector('form').addEventListener('submit', function(e) {
    const numberInputs = document.querySelectorAll('input[type="number"]');
    numberInputs.forEach(input => {
        if (input.value) {
            input.value = input.value.replace(/,/g, '');
        }
    });
});

// 실시간 폼 검증
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const requiredFields = form.querySelectorAll('input[required], select[required], textarea[required]');

    requiredFields.forEach(field => {
        field.addEventListener('blur', function() {
            if (!this.value.trim()) {
                this.classList.add('border-red-300');
                this.classList.remove('border-gray-300');
            } else {
                this.classList.remove('border-red-300');
                this.classList.add('border-gray-300');
            }
        });
    });
});
</script>

<style>
/* 폼 스타일링 */
.form-input, .form-select, .form-textarea {
    @apply border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500;
}

.form-textarea {
    resize: vertical;
    min-height: 120px;
}

/* 필수 필드 스타일 */
.border-red-300 {
    border-color: #fca5a5;
}

/* 반응형 디자인 */
@media (max-width: 768px) {
    .container {
        padding-left: 1rem;
        padding-right: 1rem;
    }

    .grid-cols-1 {
        grid-template-columns: 1fr;
    }

    .md\:grid-cols-2, .md\:grid-cols-3 {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}